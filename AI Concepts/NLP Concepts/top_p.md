
## Top_p (Nucleus Sampling)
---
top_p는 necleus sampling의 한 형태로, <font color="#ffff00">누적 확률이 지정된 임계값을 초과하지 않는 가장 확률이 높은 단어를 선택</font>합니다. 이를 계산하는 과정은 다음과 같습니다.

$$\Sigma_{x_i \in V(p)}P(x_i |x_{1:i-1}) \ge p$$

1. 확률이 높은 순서대로 단어를 정렬합니다.
2. 누적 확률이 임계값보다 크지 않을 때까지 상위 단어들을 선택합니다.

예를 들어, [[tempareture]] 를 거친 output이 다음과 같다고 가정합니다.

```
tensor([0.1955, 0.0716, 0.0122, 0.7134, 0.0073])
```

이를 확률이 높은 순서대로 단어를 정렬합니다.

```
[0.7134, 0.1955, 0.0716, 0.0122, 0.0073]
```

여기에서 `top_p = 0.95` 로 설정하고, 주어진 출력 텐서의 누적확률이 계산합니다.

- 첫 번째 단어 : 0.7134
- 첫 번째 단어와 두 번째 단어 : $0.7134+0.1955=0.9089$
- 첫 번째, 두 번째, 세 번째 단어 : $0.7134+0.1955+0.0716=0.9805$
- 첫 번째, 두 번째, 세 번째, 네 번째 단어 : $0.7134+0.1955+0.0716+0.0122 = 0.9927$
- 첫 번째, 두 번째, 세 번째, 네 번째, 다섯 번째 단어 : $1.0$

누적 확률이 0.95를 넘지 않는 상위 단어들을 선택합니다. 여기에 `top_p=0.95` 가 적용된 상위 텐서는 아래와 같습니다.

```
[0.7134, 0.1955]
```

